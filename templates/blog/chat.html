{% extends "blog/base.html" %}
{% block content %}
<div class="content-section shadow-sm bg-white p-4 rounded">
    <div class="border-bottom mb-3 pb-2 d-flex align-items-center">
        <img class="rounded-circle mr-3" src="{{ other_user.profile.image.url }}" style="width: 45px; height: 45px; object-fit: cover;">
        <div>
            <h4 class="mb-0">Chat with {{ other_user.username }}</h4>
            <small class="text-muted">Regarding: <strong>{{ post.title }}</strong></small>
        </div>
    </div>

    <div class="chat-box mb-4 p-3 border rounded bg-light" id="chat-window" style="height: 450px; overflow-y: auto;">
        {% for msg in chat_messages %}
            <div class="message-bubble {% if msg.sender == user %}message-sent{% else %}message-received{% endif %}">
                <p class="mb-0">{{ msg.content }}</p>
                <small class="d-block mt-1 {% if msg.sender == user %}text-light{% else %}text-muted{% endif %}" style="font-size: 0.7rem;">
                    {{ msg.timestamp|date:"g:i a" }}
                </small>
            </div>
        {% endfor %}
    </div>

    <form method="POST" autocomplete="off">
        {% csrf_token %}
        <div class="input-group">
            <input type="text" name="content" class="form-control border-info" placeholder="Write your message here..." required autofocus>
            <div class="input-group-append">
                <button class="btn btn-primary px-4" type="submit">Send</button>
            </div>
        </div>
    </form>
</div>

<script>
    var chatWindow = document.getElementById("chat-window");
    chatWindow.scrollTop = chatWindow.scrollHeight;
</script>
{% endblock %}